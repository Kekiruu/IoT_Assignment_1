The ESP publishes sensor information to the MQTT broker, and subscribes to the movement topic.
The ESP is programmed in C++ because using the Arduino IDE is convenient and an MQTT library can be installed directly through it.

additional boards text: https://arduino.esp8266.com/stable/package_esp8266com_index.json,https://raw.githubusercontent.com/damellis/attiny/ide-1.6.x-boards-manager/package_damellis_attiny_index.json,https://mcudude.github.io/MightyCore/package_MCUdude_MightyCore_index.json
